var open_calendar=0; var app = angular.module('myApp', ['ui.bootstrap']); app.filter('startFrom', function() {return function(input, start) {if (input) {start = +start; return input.slice(start); } return []; } }); app.controller('post', function($scope, $http, $window) {$scope.rows = function() {open_calendar=0; $(".bg-preload").show(); $(".bg-list").hide(); var req = {method: 'GET', url: $("#url").val() + '/getEventsByCategories/' + $("#lang").val() + '/' + $("#category").val(), headers: {'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;', 'x-api-key': 'rwWjQk8TPaJAcbDqi4i9TDTXWHxQzpqzdLnM5ttKYMmYpTjLp6'} }; $http(req).then(function successCallback(response) {$scope.list = response.data; $scope.currentPage = 1; $scope.entryLimit = 50; $scope.filteredItems = $scope.list.length; $scope.totalItems = $scope.list.length; $(".bg-preload").hide(); $(".bg-list").show(); }); }; $scope.searchDate = function() {if ($("#date").val() != "") {$(".bg-preload").show(); $(".bg-list").hide(); open_calendar=0; var req = {method: 'GET', url: $("#url").val() + '/getEventsByDate/' + $("#lang").val() + '/' + $("#category").val() + '/' + $("#date").val(), headers: {'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;', 'x-api-key': 'rwWjQk8TPaJAcbDqi4i9TDTXWHxQzpqzdLnM5ttKYMmYpTjLp6'} } $http(req).then(function successCallback(response) {$scope.list = response.data; $scope.currentPage = 1; $scope.entryLimit = 50; $scope.filteredItems = $scope.list.length; $scope.totalItems = $scope.list.length; $(".bg-preload").hide(); $(".bg-list").show(); }); } }; $scope.rows(); $scope.setPage = function(pageNo) {$scope.currentPage = pageNo; }; $scope.filter = function() {if ($("#search").val() == '') {$scope.filteredItems = $scope.list.length; $scope.totalItems = $scope.list.length; } else {$scope.filteredItems = $scope.filtered.length; $scope.totalItems = $scope.filtered.length; } }; $scope.sort_by = function(predicate) {$scope.predicate = predicate; $scope.reverse = !$scope.reverse; }; $scope.goToEvents = function(url) {if ($("#lang").val() == 'es') {window.location = $("#url").val() + '/es/agenda/' + url; } else {window.location = $("#url").val() + '/en/diary/' + url; } }; $scope.goToCategory = function(url) {if ($("#lang").val() == 'es') {window.location = $("#url").val() + '/es/agenda/' + url; } else {window.location = $("#url").val() + '/en/diary/' + url; } }; }); function load_calendar() {if ($("#lang").val() == 'es') {$('#datepicker').pickadate({monthsFull: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'], monthsShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'], weekdays: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'], weekdaysFull: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'], weekdaysShort: ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'], weekdaysLetter: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'], showMonthsShort: true, selectYears: true, selectMonths: true, today: false, close: false, clear: 'Volver a listado', format: 'yyyy-mm-dd', closeOnSelect: true, onOpen: function() {$("#date").val(''); }, onClose: function() {var date = this.get('select', 'yyyy-mm-dd'); $("#date").val(date); if ($("#date").val() == "") {if(open_calendar!=0){$("#tab-lists").click(); angular.element($('[ng-controller="post"]')).scope().rows(); } } else {$("#date").val(this.get('select', 'yyyy-mm-dd')); if ($("#date").val() != "") {angular.element($('[ng-controller="post"]')).scope().searchDate(); } } open_calendar=1; } }); } else {$('#datepicker').pickadate({monthsFull: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'], monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], weekdays: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'], weekdaysFull: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'], weekdaysShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], weekdaysLetter: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'], showMonthsShort: true, selectYears: true, selectMonths: true, today: false, close: false, clear: 'Back to list', format: 'yyyy-mm-dd', closeOnSelect: true, onOpen: function() {$("#date").val(''); }, onClose: function() {var date = this.get('select', 'yyyy-mm-dd'); $("#date").val(date); if ($("#date").val() == "") {} else {$("#date").val(this.get('select', 'yyyy-mm-dd')); if ($("#date").val() != "") {angular.element($('[ng-controller="post"]')).scope().searchDate(); } } } }); } } load_calendar();